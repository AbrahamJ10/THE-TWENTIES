<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Almac√©n</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <aside class="menu">
    <h2>THE TWENTIES</h2>
    <ul>
      <li><a href="usuarios.html">Usuario</a></li>
      <li class="active">Almac√©n</li>
      <li><a href="configuracion.html">Configuraci√≥n</a></li>
    </ul>
  </aside>

  <main>
    <h1>Lista de productos</h1>

    <!-- üîç Filtro de b√∫squeda -->
    <div class="filtro">
      <input type="text" id="buscarProducto" placeholder="Buscar por c√≥digo o nombre...">
    </div>

    <table id="tablaAlmacen">
      <thead>
        <tr>
          <th>C√≥digo</th>
          <th>Fecha</th>
          <th>Nombre</th>
          <th>Descripci√≥n</th>
          <th>Categor√≠a</th>
          <th>Subcategor√≠a</th>
          <th>Stock</th>
          <th>Costo</th>
          <th>Imagen</th>
          <th>Editar</th>
          <th>Eliminar</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- ‚ûï Bot√≥n Agregar -->
    <div class="acciones">
      <button id="btnAgregarProducto" class="btn agregar">Agregar nuevo producto</button>
    </div>
  </main>

  <!-- üí¨ Modal flotante (se llenar√° din√°micamente con JS) -->
  <div id="modalContainer"></div>

  <script>
    const tbody = document.querySelector('#tablaAlmacen tbody');
    const inputBuscar = document.getElementById('buscarProducto');
    let productos = [];

    // üîπ Cargar productos desde el servidor
    fetch('/api/almacen')
      .then(res => res.json())
      .then(data => {
        productos = data;
        mostrarProductos(productos);
      })
      .catch(err => console.error("Error al cargar productos:", err));

    // üîπ Mostrar productos en la tabla
    function mostrarProductos(lista) {
      tbody.innerHTML = '';
      lista.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.id_almacen}</td>
          <td>${p.fecha}</td>
          <td>${p.nombre}</td>
          <td>${p.descripcion}</td>
          <td>${p.categoria || ''}</td>
          <td>${p.subcategoria || ''}</td>
          <td>${p.stock}</td>
          <td>S/ ${p.costo}</td>
          <td>
            ${p.imagen_ruta ? `<img src="/${p.imagen_ruta}" width="40" alt="imagen">` : '‚Äî'}
          </td>
          <td><button class="btn editar" data-id="${p.id_almacen}">Editar</button></td>
          <td><button class="btn eliminar" data-id="${p.id_almacen}">Eliminar</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    // üîç Filtrar productos
    inputBuscar.addEventListener('input', e => {
      const texto = e.target.value.toLowerCase();
      const filtrados = productos.filter(p =>
        p.nombre.toLowerCase().includes(texto) ||
        p.id_almacen.toString().includes(texto)
      );
      mostrarProductos(filtrados);
    });
  </script>

  <!-- Script con las funciones CRUD -->
  <script src="/js/almacen.js"></script>
</body>
</html>
